<!doctype html>
<html>

<head>
		<title>Mixed Chart</title>
		<script src="../../dist/Chart.bundle.js"></script>
		<script src="../utils.js"></script>
		<style>
			canvas {
				-moz-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
				width: 255px;
				height: 255px;
			}
			div {
				display: flex;
				flex-wrap: wrap;
			}
			div div {
				flex-grow: 1;
				width: 33%;
			}
		</style>
</head>

<body>
		<button id="randomizeData">Randomize Data</button>
		<div id="container">
		</div>
		<script>
			var sets = [
				{
					parents: ['scatter', 'line', 'bubble', 'bar', 'horizontalBar', undefined],
					childs: [
						{type:'scatter', color:'#f844'},
						{type:'scatter', color:'#f844'},
						{type:'line', color:'#4f84', fill:false},
						{type:'bubble', color:'#8f44'},
						{type:'line', color:'#f484'},
						{type:'bar', color:'#48f4'},
						{type:'bar', color:'#84f4'}
					]
				}, {
					parents: ['scatter', 'line', 'bubble', 'bar', 'horizontalBar', undefined],
					childs: [
						{type:'scatter', color:'#f844'},
						{type:'scatter', color:'#f844'},
						{type:'line', color:'#4f84', fill:false},
						{type:'bubble', color:'#8f44'},
						{type:'line', color:'#f484'}
					]
				}, {
					parents: ['scatter', 'line', 'bubble', 'bar', 'horizontalBar', undefined],
					childs: [
						{type:'scatter', color:'#f844'},
						{type:'line', color:'#4f84', fill:false},
						{type:'bubble', color:'#8f44'},
						{type:'line', color:'#f484'},
						{type:'bar', color:'#48f4'},
						{type:'bar', color:'#48f4'},
						{type:'horizontalBar', color:'#84f4'},
					]
				}, {
					parents: ['scatter', 'line', 'bubble', 'bar', 'horizontalBar', undefined],
					childs: [
						{type:'horizontalBar', color:'#f484'},
						{type:'scatter', color:'#f844'},
						{type:'bubble', color:'#8f44'},
					]
				}
			];
			sets = [];
			childs = [
				{type:'scatter', color:'#f844'},
				{type:'line', color:'#f484', fill:false},
				{type:'bubble', color:'#8f44'},
				{type:'bar', color:'#48f4'},
				{type:'horizontalBar', color:'#84f4'},
			]
			childs.forEach(function(child1) {
				childs.forEach(function(child2) {
					childs.forEach(function(child3) {
						parent = undefined;
						sets.unshift({
							parents: [undefined],
							childs: [child1, child2, child3],
						})
					});
				});
			});
			var size = 8;
			var charts = [];
			sets.forEach(function(set) {
				var parents = set.parents;
				var childs = set.childs;
				parents.forEach(function(parent) {
					var datasets = [];
					var childId = -1;
					var labels = [];
					childs.forEach(function(child) {
						childId++;
						var data = [];
						for (var i = 0 ; i < size ; i++) {
							if (child.type === 'bubble') {
								data.push({x:randomScalingFactor(), y:randomScalingFactor(),r:Math.max(randomScalingFactor()/2, 20)});
							} else if (child.type === 'scatter') {
								data.push({x:randomScalingFactor(),y:randomScalingFactor()});
							} else {
								data.push(randomScalingFactor());
							}
							if (childId === 0) {
								labels.push('label '+(i+1));
							}
						}
						datasets.push({
							type: child.type,
							label: child.type,
							borderColor: child.color,
							backgroundColor: child.color,
							data: data,
						});
						if (child.fill !== undefined) {
							datasets[datasets.length-1].fill = child.fill;
						}
					});
					var div = document.createElement("div");
					var canvas = document.createElement("canvas");
					canvas.id = parent;
					div.appendChild(canvas);
					document.getElementById("container").appendChild(div);
					var childListstr = ''; 
					childs.forEach(function(child) {
						childListstr += child.type + ', ';
					})
					childListstr = childListstr.slice(0,-2);
					charts.push(new Chart(canvas.getContext("2d"), {
						type: parent,
						data: {
							labels: labels,
							datasets: datasets,
						},
						options: {
							responsive: true,
							title: {
								display: true,
								text: 'Parent type : ' + parent + ' | Childs : ' + childListstr,
							},
							tooltips: {
								mode: 'index',
								intersect: true
							}
						}
					}));
					/*charts[charts.length-1].update();
					var meta = charts[charts.length-1].getDatasetMeta(2)
					console.log(meta.data.length)*/
				});
			});
			console.log(charts);

			document.getElementById('randomizeData').addEventListener('click', function() {
				charts.forEach(function(chart) {
					chart.data.datasets.forEach(function(dataset) {
						dataset.data = dataset.data.map(function(a) {
								if (a.r) {
									return {x:randomScalingFactor(),y:randomScalingFactor(),r:Math.max(randomScalingFactor()/3, 10)};
								} else if (a.x) {
									return {x:randomScalingFactor(),y:randomScalingFactor()};
								}
								return randomScalingFactor();
						});
					});
					chart.update();
				});
				console.log(charts);
			});
		</script>
</body>

</html>
