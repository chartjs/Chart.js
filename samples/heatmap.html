<!doctype html>
<html>

<head>
	<title>HeatMap Chart</title>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="../dist/Chart.bundle.js"></script>
	<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	</style>
</head>

<body>
<div id="container" style="width: 75%;">
	<canvas id="canvas"></canvas>
</div>
<button id="randomizeData">Randomize Data</button>
<button id="addDataset">Add Dataset</button>
<button id="removeDataset">Remove Dataset</button>
<button id="addData">Add Data</button>
<button id="removeData">Remove Data</button>
<script>
	var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

	var randomScalingFactor = function() {
		return (Math.random() > 0.5 ? 1.0 : -1.0) * Math.round(Math.random() * 100);
	};
	var randomColorFactor = function() {
		return Math.round(Math.random() * 255);
	};
	var randomColor = function() {
		return 'rgba(' + randomColorFactor() + ',' + randomColorFactor() + ',' + randomColorFactor() + ',.7)';
	};

	var heatMapData = {
		labels: ["January", "February", "March", "April", "May", "June", "July"],
		datasets: [{
			label: 'Dataset 1',
			data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
		}, {
			label: 'Dataset 2',
			data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
		}, {
			label: 'Dataset 3',
			data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
		}]

	};

	window.onload = function() {
		var ctx = document.getElementById("canvas").getContext("2d");
		window.myChart = new Chart(ctx, {
			type: 'heatmap',
			data: heatMapData,
			options: {
				colorFunction: function(value) {
					if (value < 25) {
						return 'red';
					} else if (value > 75) {
						return 'green';
					} else {
						return 'yellow';
					}
				},
				title: {
					display: true,
					text: 'Chart.js Heat Map'
				}
			}
		});

	};

	$('#randomizeData').click(function() {
		var zero = Math.random() < 0.2 ? true : false;
		$.each(heatMapData.datasets, function(i, dataset) {
			dataset.data = dataset.data.map(function() {
				return zero ? 0.0 : randomScalingFactor();
			});

		});
		window.myChart.update();
	});

	$('#addDataset').click(function() {
		var newDataset = {
			label: 'Dataset ' + (heatMapData.datasets.length+1),
			data: []
		};

		for (var index = 0; index < heatMapData.labels.length; ++index) {
			newDataset.data.push(randomScalingFactor());
		}

		heatMapData.datasets.push(newDataset);
		window.myChart.update();
	});

	$('#addData').click(function() {
		if (heatMapData.datasets.length > 0) {
			var month = MONTHS[heatMapData.labels.length % MONTHS.length];
			heatMapData.labels.push(month);

			for (var index = 0; index < heatMapData.datasets.length; ++index) {
				heatMapData.datasets[index].data.push(randomScalingFactor());
			}

			window.myChart.update();
		}
	});

	$('#removeDataset').click(function() {
		heatMapData.datasets.splice(0, 1);
		window.myChart.update();
	});

	$('#removeData').click(function() {
		heatMapData.labels.splice(-1, 1); // remove the label first

		heatMapData.datasets.forEach(function(dataset, datasetIndex) {
			dataset.data.pop();
		});

		window.myChart.update();
	});
</script>
</body>

</html>
